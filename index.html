function doPost(e) {
  const SHEET_ID = "1nbvSBpWY_6cexjjdsgwfj7bHUSQVfKzrHbgFwwOXOPc";
  const SHEET_NAME = "RFT_Email_Collector";

  const ss = SpreadsheetApp.openById(SHEET_ID);
  let sheet = ss.getSheetByName(SHEET_NAME);

  if (!sheet) {
    sheet = ss.insertSheet(SHEET_NAME);
    sheet.appendRow(["DATE", "TIME", "EMAIL"]);
  }

  const email = e.parameter.email;
  if (!email) {
    return ContentService.createTextOutput("Missing email");
  }

  const now = new Date();
  sheet.appendRow([
    Utilities.formatDate(now, "Asia/Kolkata", "dd-MM-yyyy"),
    Utilities.formatDate(now, "Asia/Kolkata", "HH:mm:ss"),
    email
  ]);

  GmailApp.sendEmail(
    email,
    "Welcome to RightFitTalent",
    "Thank you for registering. Our support@rftalent.in will reach out."
  );

  return ContentService
    .createTextOutput("OK")
    .setHeader("Access-Control-Allow-Origin", "https://reftalent.in");
}
